<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BOX SPORTS - Canlı Spor Yayını</title>

<!-- Favicon -->
<link rel="icon" href="https://hizliresim.com/2k46hi5" type="image/png" />

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L72XKZ22X2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-L72XKZ22X2');
</script>

<!-- HLS.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

<style>
  /* --- GENEL --- */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Inter', sans-serif;
    margin: 0; padding: 0;
    background: #f4f8ff;
    color: #004080;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  a {
    color: #004080;
    text-decoration: none;
  }

  /* --- HEADER --- */
  header {
    display: flex;
    align-items: center;
    background: #0077cc;
    color: white;
    padding: 10px 20px;
    gap: 15px;
  }
  header .logo {
    width: 40px;
    height: 40px;
    object-fit: contain;
  }
  #header-title {
    font-weight: 700;
    font-size: 24px;
    flex-grow: 1;
  }
  button.theme-toggle {
    background: white;
    border: none;
    border-radius: 50%;
    padding: 6px;
    cursor: pointer;
    width: 36px; height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.3s ease;
    color: #0077cc;
  }
  button.theme-toggle:hover {
    background-color: #e0f0ff;
  }
  button.theme-toggle svg {
    stroke: #0077cc;
    width: 24px; height: 24px;
  }
  .clock {
    font-weight: 600;
    font-size: 16px;
    min-width: 70px;
    text-align: right;
  }

  /* --- ANA KISIM --- */
  main.container {
    flex: 1;
    display: flex;
    gap: 20px;
    padding: 20px;
  }

  /* Kanal Listesi */
  nav.channel-list {
    width: 280px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  #searchInput {
    padding: 8px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #aaa;
  }
  #filterCategory {
    padding: 8px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #aaa;
  }
  #channelContainer {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: white;
  }
  .channel {
    padding: 12px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background 0.3s;
  }
  .channel:hover, .channel.active {
    background: #cce5ff;
  }
  .channel-name {
    font-weight: 600;
    font-size: 16px;
  }
  .channel-category {
    font-size: 12px;
    color: #666;
  }

  /* Video oynatıcı */
  section.video-player {
    flex: 1;
    background: black;
    border-radius: 6px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  #video {
    width: 100%;
    height: 100%;
    max-height: 480px;
    background: black;
  }

  /* Hata mesajı */
  #errorMessage {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: #ff4444;
    background: rgba(0,0,0,0.7);
    padding: 12px 20px;
    border-radius: 6px;
    font-weight: 700;
    display: none;
    z-index: 10;
  }

  /* Footer */
  footer {
    padding: 12px 20px;
    background: #0077cc;
    color: white;
    text-align: center;
    font-weight: 600;
  }

  /* --- KARANLIK MOD --- */
  [data-theme="dark"] {
    background: #121212;
    color: #eee;
  }
  [data-theme="dark"] header {
    background: #005599;
  }
  [data-theme="dark"] nav.channel-list {
    background: #222;
  }
  [data-theme="dark"] #channelContainer {
    border-color: #444;
    background: #222;
  }
  [data-theme="dark"] .channel:hover, [data-theme="dark"] .channel.active {
    background: #004080;
  }
  [data-theme="dark"] #searchInput, [data-theme="dark"] #filterCategory {
    background: #333;
    color: #eee;
    border-color: #555;
  }
  [data-theme="dark"] section.video-player {
    background: #000;
  }
  [data-theme="dark"] footer {
    background: #005599;
  }
</style>

</head>
<body>

<header role="banner" aria-label="Sayfa Başlığı">
  <img class="logo" src="https://hizliresim.com/2k46hi5" alt="Box Sports Logo" title="Box Sports" />
  <span id="header-title">Box Sports</span>

  <button aria-label="Tema değiştirici" id="themeToggle" class="theme-toggle" title="Tema değiştir">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"/>
      <line x1="12" y1="1" x2="12" y2="3" />
      <line x1="12" y1="21" x2="12" y2="23" />
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
      <line x1="1" y1="12" x2="3" y2="12" />
      <line x1="21" y1="12" x2="23" y2="12" />
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
    </svg>
  </button>

  <div class="clock" id="clock" aria-live="polite" aria-atomic="true"></div>
</header>

<main class="container" role="main">
  <nav class="channel-list" aria-label="Kanal Listesi">
    <input type="text" id="searchInput" placeholder="Kanal Ara..." aria-label="Kanal Ara" />
    <select id="filterCategory" aria-label="Kategori Filtrele" title="Kategori Filtrele">
      <option value="all">Tüm Kategoriler</option>
    </select>
    <div id="channelContainer" tabindex="0" aria-live="polite" aria-atomic="true"></div>
  </nav>

  <section class="video-player" aria-label="Video Oynatıcı">
    <video id="video" controls autoplay playsinline></video>
    <div id="errorMessage" role="alert" aria-live="assertive"></div>
  </section>
</main>

<footer>
  &copy; 2025 Box Sports | Tüm Hakları Saklıdır.
</footer>

<script>
"use strict";

let channels = [];
let filteredChannels = [];
let activeChannelId = null;

const video = document.getElementById('video');
const channelContainer = document.getElementById('channelContainer');
const searchInput = document.getElementById('searchInput');
const filterCategory = document.getElementById('filterCategory');
const themeToggle = document.getElementById('themeToggle');
const errorMessage = document.getElementById('errorMessage');
const clock = document.getElementById('clock');

let hls = null;

// Tarih ve saati güncelle
function updateClock() {
  const now = new Date();
  clock.textContent = now.toLocaleTimeString('tr-TR', { hour12: false });
}
setInterval(updateClock, 1000);
updateClock();

// Tema değiştirme ve kaydetme
function loadTheme() {
  const saved = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  document.documentElement.setAttribute('data-theme', saved);
  updateThemeIcon(saved);
}
function saveTheme(theme) {
  localStorage.setItem('theme', theme);
}
function updateThemeIcon(theme) {
  if(theme === 'dark') {
    themeToggle.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="#fff">
      <path d="M21 12.79A9 9 0 1111.21 3a7 7 0 009.79 9.79z"/>
    </svg>`;
  } else {
    themeToggle.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="#0077cc">
      <circle cx="12" cy="12" r="5"/>
      <line x1="12" y1="1" x2="12" y2="3" />
      <line x1="12" y1="21" x2="12" y2="23" />
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
      <line x1="1" y1="12" x2="3" y2="12" />
      <line x1="21" y1="12" x2="23" y2="12" />
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
    </svg>`;
  }
}
themeToggle.addEventListener('click', () => {
  const current = document.documentElement.getAttribute('data-theme');
  const next = current === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', next);
  saveTheme(next);
  updateThemeIcon(next);
});
loadTheme();

// Kanalları JSON dosyasından yükle
async function loadChannels() {
  try {
    const response = await fetch('kanallar.json');
    if(!response.ok) throw new Error('Kanallar yüklenemedi');
    channels = await response.json();
    setupCategories();
    filteredChannels = [...channels];
    renderChannels();
  } catch (err) {
    console.error(err);
    channelContainer.innerHTML = '<p style="padding: 12px; color: red;">Kanallar yüklenemedi.</p>';
  }
}

// Kategori seçeneklerini ayarla
function setupCategories() {
  const categories = [...new Set(channels.map(ch => ch.kategori))].sort();
  filterCategory.innerHTML = '<option value="all">Tüm Kategoriler</option>';
  for(const cat of categories) {
    filterCategory.innerHTML += `<option value="${cat}">${cat}</option>`;
  }
}

// Kanalları listele
function renderChannels() {
  channelContainer.innerHTML = '';
  if(filteredChannels.length === 0) {
    channelContainer.innerHTML = '<p style="padding: 12px;">Kanal bulunamadı.</p>';
    return;
  }
  for(const ch of filteredChannels) {
    const div = document.createElement('div');
    div.className = 'channel';
    div.setAttribute('role', 'button');
    div.setAttribute('tabindex', '0');
    div.dataset.id = ch.id;
    div.innerHTML = `<div class="channel-name">${ch.ad}</div><div class="channel-category">${ch.kategori}</div>`;
    if(ch.id === activeChannelId) div.classList.add('active');
    div.onclick = () => selectChannel(ch.id);
    div.onkeypress = (e) => { if(e.key === 'Enter' || e.key === ' ') { selectChannel(ch.id); e.preventDefault(); } };
    channelContainer.appendChild(div);
  }
}

// Kanal seçimi ve oynatma
function selectChannel(id) {
  if(id === activeChannelId) return;
  activeChannelId = id;
  renderChannels();
  const channel = channels.find(c => c.id === id);
  if(channel) {
    playStream(channel.url);
    clearError();
  }
}

// Arama ve filtre işlemleri
searchInput.addEventListener('input', filterChannels);
filterCategory.addEventListener('change', filterChannels);

function filterChannels() {
  const searchTerm = searchInput.value.trim().toLowerCase();
  const category = filterCategory.value;
  filteredChannels = channels.filter(ch => {
    const matchName = ch.ad.toLowerCase().includes(searchTerm);
    const matchCategory = category === 'all' || ch.kategori === category;
    return matchName && matchCategory;
  });
  renderChannels();
}

// HLS.js ile yayın oynatma
function playStream(url) {
  if(hls) {
    hls.destroy();
    hls = null;
  }
  clearError();

  if(Hls.isSupported()) {
    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);

    hls.on(Hls.Events.MANIFEST_PARSED, function() {
      video.play().catch(() => {
        // otomatik oynatma engellenmiş olabilir
      });
    });

    hls.on(Hls.Events.ERROR, function(event, data) {
      console.error("HLS.js hatası:", data);
      if(data.details === Hls.ErrorDetails.FRAG_PARSING_ERROR) {
        showError("Yayın segmentleri desteklenmeyen formatta olabilir. Yayın oynatılamıyor.");
      }
      if(data.fatal) {
        switch(data.type) {
          case Hls.ErrorTypes.NETWORK_ERROR:
            showError("Ağ hatası: Yayın yüklenemiyor.");
            hls.startLoad();
            break;
          case Hls.ErrorTypes.MEDIA_ERROR:
            showError("Medya hatası: Yayın oynatılamıyor.");
            hls.recoverMediaError();
            break;
          default:
            showError("Ciddi hata oluştu, yayın oynatılamıyor.");
            hls.destroy();
            break;
        }
      }
    });
  } else if(video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = url;
    video.addEventListener('loadedmetadata', function() {
      video.play().catch(() => {});
    });
  } else {
    showError('Tarayıcınız HLS akışını desteklemiyor.');
  }
}

function showError(msg) {
  errorMessage.textContent = msg;
  errorMessage.style.display = 'block';
  video.style.display = 'none';
}
function clearError() {
  errorMessage.style.display = 'none';
  errorMessage.textContent = '';
  video.style.display = 'block';
}

// İlk kanal otomatik seç
loadChannels().then(() => {
  if(channels.length > 0) selectChannel(channels[0].id);
});
</script>

</body>
</html>
