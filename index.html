<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BOX SPORTS - Canlı Spor Yayını</title>

<!-- Favicon -->
<link rel="icon" href="https://hizliresim.com/2k46hi5" type="image/png" />

<!-- HLS.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

<style>
  /* --- GENEL --- */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Inter', sans-serif;
    margin: 0; padding: 0;
    background: #f4f8ff;
    color: #004080;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  a {
    color: #004080;
    text-decoration: none;
  }

  /* --- HEADER --- */
  header {
    display: flex;
    align-items: center;
    background: #0077cc;
    color: white;
    padding: 10px 20px;
    gap: 15px;
  }
  header img {
    width: 36px;
    height: 36px;
  }
  #header-title {
    font-weight: 700;
    font-size: 24px;
    flex-grow: 1;
  }
  select.lang-select, button.theme-toggle {
    background: white;
    border: none;
    border-radius: 4px;
    padding: 6px 10px;
    cursor: pointer;
    font-weight: 600;
    color: #0077cc;
  }
  button.theme-toggle {
    width: 36px; height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  button.theme-toggle svg {
    fill: #0077cc;
    width: 24px; height: 24px;
  }
  .clock {
    font-weight: 600;
    font-size: 16px;
    min-width: 70px;
    text-align: right;
  }

  /* --- ANA KISIM --- */
  main.container {
    flex: 1;
    display: flex;
    gap: 20px;
    padding: 20px;
  }

  /* Kanal Listesi */
  nav.channel-list {
    width: 280px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  #searchInput {
    padding: 8px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #aaa;
  }
  #filterCategory {
    padding: 8px;
    font-size: 14px;
    border-radius: 6px;
    border: 1px solid #aaa;
  }
  #channelContainer {
    flex: 1;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 6px;
    background: white;
  }
  .channel {
    padding: 12px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background 0.3s;
  }
  .channel:hover, .channel.active {
    background: #cce5ff;
  }
  .channel-name {
    font-weight: 600;
    font-size: 16px;
  }
  .channel-category {
    font-size: 12px;
    color: #666;
  }

  /* Video oynatıcı */
  section.video-player {
    flex: 1;
    background: black;
    border-radius: 6px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #video {
    width: 100%;
    height: 100%;
    max-height: 480px;
    background: black;
  }

  /* Footer */
  footer {
    padding: 12px 20px;
    background: #0077cc;
    color: white;
    text-align: center;
    font-weight: 600;
  }

  /* --- KARANLIK MOD --- */
  [data-theme="dark"] {
    background: #121212;
    color: #eee;
  }
  [data-theme="dark"] header {
    background: #005599;
  }
  [data-theme="dark"] nav.channel-list {
    background: #222;
  }
  [data-theme="dark"] #channelContainer {
    border-color: #444;
    background: #222;
  }
  [data-theme="dark"] .channel:hover, [data-theme="dark"] .channel.active {
    background: #004080;
  }
  [data-theme="dark"] #searchInput, [data-theme="dark"] #filterCategory {
    background: #333;
    color: #eee;
    border-color: #555;
  }
  [data-theme="dark"] section.video-player {
    background: #000;
  }
  [data-theme="dark"] footer {
    background: #005599;
  }
</style>

</head>
<body>

<header role="banner" aria-label="Sayfa Başlığı">
  <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Box Sports Logo" title="Box Sports" />
  <span id="header-title">Box Sports</span>

  <select aria-label="Dil seçici" class="lang-select" id="langSelect" title="Dil Seç">
    <option value="tr">Türkçe</option>
    <option value="en">English</option>
  </select>

  <button aria-label="Tema değiştirici" id="themeToggle" class="theme-toggle" title="Tema değiştir">
    <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <circle cx="12" cy="12" r="5"/>
    </svg>
  </button>

  <div class="clock" id="clock" aria-live="polite" aria-atomic="true"></div>
</header>

<main class="container" role="main">
  <nav class="channel-list" aria-label="Kanal Listesi">
    <input type="text" id="searchInput" placeholder="Kanal Ara..." aria-label="Kanal Ara" />
    <select id="filterCategory" aria-label="Kategori Filtrele" title="Kategori Filtrele">
      <option value="all">Tüm Kategoriler</option>
    </select>
    <div id="channelContainer" tabindex="0" aria-live="polite" aria-atomic="true"></div>
  </nav>

  <section class="video-player" aria-label="Video Oynatıcı">
    <video id="video" controls autoplay playsinline></video>
  </section>
</main>

<footer>
  &copy; 2025 Box Sports | Tüm Hakları Saklıdır.
</footer>

<script>
"use strict";

// Çoklu dil içerikleri
const langData = {
  tr: {
    searchPlaceholder: "Kanal Ara...",
    allCategories: "Tüm Kategoriler",
    liveStatus: "Canlı",
    offlineStatus: "Çevrimdışı",
    errorLoadChannels: "Kanallar yüklenemedi.",
    errorLoadStream: "Yayın yüklenemedi.",
    headerTitle: "Box Sports",
  },
  en: {
    searchPlaceholder: "Search channel...",
    allCategories: "All Categories",
    liveStatus: "Live",
    offlineStatus: "Offline",
    errorLoadChannels: "Failed to load channels.",
    errorLoadStream: "Failed to load stream.",
    headerTitle: "Box Sports",
  }
};

let currentLang = 'tr';
let channels = [];
let filteredChannels = [];
let activeChannelId = null;

const video = document.getElementById('video');
const channelContainer = document.getElementById('channelContainer');
const searchInput = document.getElementById('searchInput');
const filterCategory = document.getElementById('filterCategory');
const langSelect = document.getElementById('langSelect');
const themeToggle = document.getElementById('themeToggle');
const themeIcon = document.getElementById('themeIcon');
const clock = document.getElementById('clock');
const headerTitle = document.getElementById('header-title');

let hls = null;

// Tema fonksiyonları
function applyTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('theme', theme);
  updateThemeIcon(theme);
}
function updateThemeIcon(theme) {
  if(theme === 'dark') {
    themeIcon.innerHTML = '<path fill="none" d="M0 0h24v24H0z"/><path fill="#FFF" d="M12 3a9 9 0 1 0 9 9a9 9 0 0 1-9-9z"/>';
  } else {
    themeIcon.innerHTML = '<circle cx="12" cy="12" r="5" fill="#0077cc"/>';
  }
}
function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme') || 'light';
  const next = current === 'light' ? 'dark' : 'light';
  applyTheme(next);
}

// Saat güncelle
function updateClock() {
  const now = new Date();
  const timeString = now.toLocaleTimeString(currentLang === 'tr' ? 'tr-TR' : 'en-US', {hour12:false});
  clock.textContent = timeString;
}
setInterval(updateClock, 1000);
updateClock();

// Dil değiştirici
langSelect.addEventListener('change', () => {
  currentLang = langSelect.value;
  updateTexts();
  filterChannels();
});

function updateTexts() {
  searchInput.placeholder = langData[currentLang].searchPlaceholder;
  filterCategory.options[0].textContent = langData[currentLang].allCategories;
  headerTitle.textContent = langData[currentLang].headerTitle;
}

function fetchChannels() {
  fetch('kanal.json')
    .then(res => {
      if(!res.ok) throw new Error(langData[currentLang].errorLoadChannels);
      return res.json();
    })
    .then(data => {
      channels = data;
      populateCategoryFilter();
      filterChannels();
    })
    .catch(err => {
      channelContainer.innerHTML = `<p style="padding:10px;color:red;">${err.message}</p>`;
    });
}

function populateCategoryFilter() {
  // Kategorileri al, benzersiz hale getir
  const categories = [...new Set(channels.map(ch => ch.category))].sort();
  // Mevcut seçenekleri temizle
  filterCategory.innerHTML = '';
  // Tüm kategoriler seçeneği
  const allOption = document.createElement('option');
  allOption.value = 'all';
  allOption.textContent = langData[currentLang].allCategories;
  filterCategory.appendChild(allOption);

  categories.forEach(cat => {
    const opt = document.createElement('option');
    opt.value = cat;
    opt.textContent = cat;
    filterCategory.appendChild(opt);
  });
}

function filterChannels() {
  const searchTerm = searchInput.value.trim().toLowerCase();
  const selectedCategory = filterCategory.value;

  filteredChannels = channels.filter(ch => {
    const matchSearch = ch.name.toLowerCase().includes(searchTerm);
    const matchCategory = selectedCategory === 'all' || ch.category === selectedCategory;
    return matchSearch && matchCategory;
  });

  renderChannels();
}

function renderChannels() {
  if(filteredChannels.length === 0) {
    channelContainer.innerHTML = `<p style="padding:10px;">${langData[currentLang].errorLoadChannels}</p>`;
    return;
  }
  channelContainer.innerHTML = '';
  filteredChannels.forEach(ch => {
    const div = document.createElement('div');
    div.className = 'channel';
    div.tabIndex = 0;
    if(ch.id === activeChannelId) div.classList.add('active');
    div.setAttribute('role', 'button');
    div.setAttribute('aria-pressed', ch.id === activeChannelId ? 'true' : 'false');
    div.innerHTML = `
      <div class="channel-name">${ch.name}</div>
      <div class="channel-category">${ch.category}</div>
    `;
    div.addEventListener('click', () => {
      selectChannel(ch.id);
    });
    div.addEventListener('keypress', (e) => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        selectChannel(ch.id);
      }
    });
    channelContainer.appendChild(div);
  });
}

function selectChannel(id) {
  if(activeChannelId === id) return;
  activeChannelId = id;
  renderChannels();
  const channel = channels.find(ch => ch.id === id);
  if(!channel) return;

  playStream(channel.stream_url);
}

// Video oynatma
function playStream(url) {
  if(hls) {
    hls.destroy();
    hls = null;
  }
  if(Hls.isSupported()) {
    hls = new Hls();
    hls.loadSource(url);
    hls.attachMedia(video);
    hls.on(Hls.Events.ERROR, function(event, data) {
      if(data.fatal) {
        console.error('HLS.js fatal error:', data);
        alert(langData[currentLang].errorLoadStream);
      }
    });
  } else if(video.canPlayType('application/vnd.apple.mpegurl')) {
    video.src = url;
  } else {
    alert(langData[currentLang].errorLoadStream);
  }
  video.play().catch(console.error);
}

// Event listenerlar
searchInput.addEventListener('input', filterChannels);
filterCategory.addEventListener('change', filterChannels);
themeToggle.addEventListener('click', toggleTheme);

// Başlangıçta temayı yükle
const savedTheme = localStorage.getItem('theme') || 'light';
applyTheme(savedTheme);

// Başlangıçta dil ve kanalları yükle
updateTexts();
fetchChannels();

</script>

</body>
</html>
